
include(@cdat_CMAKE_BINARY_DIR@/cdat_common_environment.cmake)

set(ENV{ESMF_DIR} @esmf_source@)
set(ENV{ESMF_INSTALL_PREFIX} @esmf_install@)
set(ENV{ESMF_COMM} mpiuni)
set(ENV{ESMF_PTHREADS} @esmf_pthreads@)
set(ENV{CFLAGS} ${cdat_osx_flags_fortran})
set(ENV{CXXFLAGS} ${cdat_osx_flags_fortran})
set(ENV{CPPFLAGS} ${cdat_osx_flags_fortran})
set(ENV{FFLAGS} ${cdat_osx_flags_fortran})

execute_process(
  COMMAND make install
  WORKING_DIRECTORY @esmf_source@
  OUTPUT_VARIABLE CDAT_OUT
  ERROR_VARIABLE CDAT_ERR
  RESULT_VARIABLE res)

set(esmf_source @esmf_source@)
set(esmf_install @esmf_install@)
set(mpiuni @mpiuni@)
set(esmf_pthreads @esmf_pthreads@)

# Store the configuration used to build ESMF
set(infile @esmf_source@/set_esmf_env_ser.sh.in)
set(outfile @esmf_source@/set_esmf_env_ser.sh)
configure_file(${infile} ${outfile})


if(NOT ${res} EQUAL 0)
  message("Install Errors detected: \n${CDAT_OUT}\n${CDAT_ERR}")
  message(FATAL_ERROR "Error in Install")
endif()
message("Install succeeded.")
